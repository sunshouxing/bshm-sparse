name: ${topology.name}

config:
  pystorm.log.backup_count: 10
  pystorm.log.file: pystorm_{topology_name}_{component_name}_{task_id}_{pid}.log
  pystorm.log.level: debug
  pystorm.log.max_bytes: 100000
  pystorm.log.path: /logs
  storm.workers.list: []
  topology.workers: 1
  topology.message.timeout.secs: 60
  topology.max.spout.pending: 30

components:
  - id: bshmScheme
    className: bshm.spouts.scheme.BshmScheme

  - id: stringMultiScheme
    className: org.apache.storm.spout.SchemeAsMultiScheme
    constructorArgs:
      - ref: bshmScheme

  - id: zkHosts
    className: org.apache.storm.kafka.ZkHosts
    constructorArgs:
      - zookeeper:2888

  - id: spoutConfig
    className: org.apache.storm.kafka.SpoutConfig
    constructorArgs:
      # brokerHosts
      - ref: zkHosts
      # topic
      - ${kafka.topic}
      # zkRoot
      - /kafkaSpout
      # id
      - myId
    properties:
      - name: ignoreZkOffsets
        value: true
      - name: scheme
        ref: stringMultiScheme

  - id: mongoMapper
    className: bshm.bolts.mongodb.common.mapper.SimpleMongoMapper
    configMethods:
      - name: withFields
        args:
          - - timestamp
            - time_increment
            - channel_name
            - data

# spout definitions
spouts:
  - id: bshmSpout
    className: org.apache.storm.kafka.KafkaSpout
    constructorArgs:
      - ref: spoutConfig
    parallelism: 1

# bolt definitions
bolts:

  - id: mongoBolt
    className: org.apache.storm.mongodb.bolt.MongoInsertBolt
    constructorArgs:
      - ${mongodb.url}
      - ${mongodb.collection}
      - ref: mongoMapper
    parallelism: 2

  - id: logInfoBolt
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.log_info.LogInfoBolt
    parallelism: 1

  - id: tdmsParseBolt
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.tdms_parse.TDMSParseBolt
    configMethods:
      - name: setNamedStream
        args:
          - no-strains
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-02-S01
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-02-S02
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-02-S03
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-02-S04
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-03-S01
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-03-S02
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-03-S03
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-03-S04
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-03-S05
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-03-S06
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-04-S01
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-04-S02
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-04-S03
          - ${channel.tuple.fields}
      - name: setNamedStream
        args:
          - FCXF-X-04-S04
          - ${channel.tuple.fields}
    parallelism: 4

  - id: detrendBolt01
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt02
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt03
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt04
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt05
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt06
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt07
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt08
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt09
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt10
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt11
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt12
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt13
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

  - id: detrendBolt14
    className: org.apache.storm.flux.wrappers.bolts.FluxShellBolt
    constructorArgs:
      - - streamparse_run
        - -s json bolts.detrend.DetrendBolt
    configMethods:
      - name: addComponentConfig
        args:
          - min_tup_num
          - 4
      - name: setNamedStream
        args:
          - detrend
          - ${channel.tuple.fields}
    parallelism: 1

# streams defination
includes:
  - resource: false
    file: 'streams-baofu-simple.yaml'
    override: false

# vim:set sw=2 ts=2 sts=2: #
